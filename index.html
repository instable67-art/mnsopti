<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>MNS OPTI</title>

<style>
:root{
  --bg:#050505;
  --card:#0d0d0d;
  --stroke:#2b2b2b;
  --text:#ffffff;
  --muted:#b9b9b9;
  --accent:#ffffff;
  --radius:16px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:
    radial-gradient(1200px 600px at 50% 0%, rgba(255,255,255,0.08), transparent 60%),
    var(--bg);
  color:var(--text);
}
a{color:#fff}
.wrap{max-width:1100px;margin:0 auto;padding:20px}

/* ===== TOP BAR ===== */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  margin-bottom:18px;
}
.logoBtn{
  width:70px;height:70px;
  border-radius:16px;
  border:1px solid var(--stroke);
  background:rgba(0,0,0,.35);
  display:grid;place-items:center;
  cursor:pointer;
  transition:transform .25s ease, box-shadow .25s ease;
  user-select:none;
}
.logoBtn:hover{transform:translateY(-2px)}
.logoBtn:active{transform:scale(1.08) rotate(8deg)}
.logoImg{width:48px;height:48px;object-fit:contain}

.bannerBtn{
  max-width:420px;
  width:100%;
  border-radius:18px;
  overflow:hidden;
  border:1px solid var(--stroke);
  cursor:pointer;
  user-select:none;
}
.bannerImg{
  width:100%;
  display:block;
  transition:transform .6s ease;
}
.bannerBtn:hover .bannerImg{transform:scale(1.05)}
.bannerBtn:active .bannerImg{transform:scale(1.02)}

/* ===== TITRE ===== */
.headerText{
  text-align:center;
  margin-bottom:22px;
}
.headerText h1{
  margin:0;
  font-size:38px;
  letter-spacing:2px;
}
.headerText p{
  margin-top:6px;
  color:var(--muted);
}

/* ===== GRID ===== */
.grid{
  display:grid;
  grid-template-columns:1.1fr .9fr;
  gap:18px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
  .topbar{flex-direction:column;align-items:stretch}
  .bannerBtn{max-width:100%}
}

/* ===== CARDS ===== */
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  padding:18px;
}
h2{margin:0 0 12px;font-size:18px}
.muted{color:var(--muted);font-size:14px}

/* ===== SHOP ===== */
.shopList{display:flex;flex-direction:column;gap:10px}
.shopItem{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding:14px;
  border:1px solid var(--stroke);
  border-radius:14px;
  background:rgba(0,0,0,.25);
  transition:transform .2s ease, border-color .2s ease;
}
.shopItem:hover{transform:translateY(-2px);border-color:rgba(255,255,255,.16)}
.pill{
  border:1px solid var(--stroke);
  border-radius:999px;
  padding:4px 10px;
  font-size:12px;
  color:var(--muted);
}
.price{font-weight:900;white-space:nowrap}
.shopActions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

/* ===== BUTTONS ===== */
button{
  border:none;
  border-radius:12px;
  padding:12px 14px;
  font-weight:800;
  cursor:pointer;
  background:var(--accent);
  color:#000;
}
button:disabled{opacity:.5;cursor:not-allowed}
.btnGhost{
  background:transparent;
  color:#fff;
  border:1px solid var(--stroke);
}
.btnSmall{padding:10px 12px}

/* ===== FORM ===== */
label{display:block;margin-top:12px;font-size:13px;color:var(--muted)}
input,textarea{
  width:100%;margin-top:8px;padding:12px;
  border-radius:12px;border:1px solid var(--stroke);
  background:rgba(0,0,0,.25);color:#fff;
}
textarea{min-height:110px}

/* ===== TICKETS LIST ===== */
.ticketsList{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.ticketBox{border:1px solid var(--stroke);background:rgba(0,0,0,.25);border-radius:14px;padding:12px}
.ticketTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
.ticketId{font-size:13px;color:var(--muted)}
.ticketMsg{margin:10px 0 0;font-size:14px;white-space:pre-wrap;word-break:break-word}

/* ===== API STATE ===== */
.statusDot{
  display:inline-block;
  width:8px;height:8px;border-radius:999px;
  background: rgba(255,255,255,0.25);
  margin-right:8px;
  vertical-align:middle;
}
.statusOk{ background: rgba(255,255,255,0.95); }
.statusWarn{ background: rgba(255,255,255,0.55); }
.statusBad{ background: rgba(255,255,255,0.18); }

/* ===== FOOTER ===== */
footer{
  margin:28px 0 10px;
  padding-top:18px;
  border-top:1px solid var(--stroke);
  text-align:center;
  color:var(--muted);
  font-size:13px;
}
</style>
</head>

<body>
<div class="wrap">

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="logoBtn" id="logoBtn" title="Logo">
      <img src="logo.png" class="logoImg" alt="Logo"
           onerror="this.style.display='none'; this.parentElement.textContent='M'; this.parentElement.style.fontSize='28px'; this.parentElement.style.fontWeight='900';">
    </div>

    <div class="bannerBtn" id="bannerBtn" title="Banni√®re">
      <img src="banner.png" class="bannerImg" alt="Banner"
           onerror="this.style.display='none'; this.parentElement.style.padding='16px'; this.parentElement.innerHTML='<div style=&quot;color:#b9b9b9;text-align:center&quot;>Ajoute <b>banner.png</b> dans le repo</div>';">
    </div>
  </div>

  <div class="headerText">
    <h1>MNS OPTI</h1>
    <p>Boutique + Tickets ‚Üí Discord</p>
  </div>

  <div class="grid">

    <!-- SHOP -->
    <div class="card">
      <h2>üõí Boutique ‚Äì MNS NIC</h2>
      <p class="muted">Clique sur ‚ÄúAcheter‚Äù pour pr√©-remplir le ticket.</p>

      <div id="shopList" class="shopList"></div>

      <p class="muted" style="margin-top:12px;">Paiements accept√©s : <b>PayPal / Crypto / Carte</b></p>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button type="button" id="buyDiscordBtn">Acheter via Discord</button>
        <button type="button" class="btnGhost" id="goTicketBtn">Cr√©er un ticket</button>
      </div>

      <div class="muted" id="apiState" style="margin-top:12px;">
        <span class="statusDot"></span>‚è≥ V√©rification API‚Ä¶
      </div>
    </div>

    <!-- LOCAL TICKETS -->
    <div class="card">
      <h2>üìå Mes tickets (local)</h2>
      <p class="muted">Ils sont enregistr√©s dans ton navigateur.</p>

      <div id="ticketsList" class="ticketsList"></div>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button type="button" class="btnGhost" id="discordBtn">Aller sur Discord</button>
        <button type="button" class="btnGhost" id="clearBtn">Tout supprimer</button>
      </div>
    </div>

  </div>

  <!-- CREATE TICKET -->
  <div class="card" id="ticketsSection" style="margin-top:18px;">
    <h2>üé´ Cr√©er un ticket</h2>
    <p class="muted">Ton message est envoy√© au bot Discord via Render.</p>

    <form id="ticketForm">
      <label>Pseudo</label>
      <input id="pseudo" required placeholder="Ton pseudo" />

      <label>Contact (optionnel)</label>
      <input id="contact" placeholder="email / discord / etc" />

      <label>Sujet</label>
      <input id="subject" required placeholder="Ex: Achat, probl√®me, question..." />

      <label>D√©tails</label>
      <textarea id="details" required placeholder="Explique ta demande..."></textarea>

      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="submitBtn" type="submit">Cr√©er le ticket</button>
        <button type="button" class="btnGhost" id="resetBtn">Effacer</button>
      </div>
    </form>
  </div>

  <footer>
    Discord : <a href="https://discord.gg/mnsopti" target="_blank" rel="noreferrer">discord.gg/mnsopti</a><br>
    ¬© 2026 MNS OPTI
  </footer>

</div>

<script>
  // =============================
  // CONFIG
  // =============================
  const API_URL = "https://mnsopti-bot.onrender.com"; // <-- mets ton URL Render ici si diff√©rente
  const STORAGE_KEY = "mnsopti_tickets_v7";

  // PRIX DYNAMIQUES
  const OFFERS = [
    {id:"week", label:"1 semaine", price:5},
    {id:"month", label:"1 mois", price:10},
    {id:"3months", label:"3 mois", price:15},
    {id:"lifetime", label:"Lifetime", price:25},
  ];

  // =============================
  // Helpers
  // =============================
  const $ = (id) => document.getElementById(id);
  const openDiscord = () => window.open("https://discord.gg/mnsopti", "_blank");
  const scrollToTickets = () => $("ticketsSection")?.scrollIntoView({behavior:"smooth"});

  const esc = (s) => String(s ?? "")
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");

  function loadTickets(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
    catch { return []; }
  }
  function saveTickets(list){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    renderTickets();
  }

  // =============================
  // Shop render + buy per product
  // =============================
  function renderShop(){
    const root = $("shopList");
    root.innerHTML = OFFERS.map(o => `
      <div class="shopItem">
        <div>
          <b>${esc(o.label)}</b> <span class="pill">Acc√®s</span>
          <div class="muted" style="font-size:12px;margin-top:4px;">Support + activation rapide</div>
        </div>
        <div class="shopActions">
          <div class="price">${o.price} ‚Ç¨</div>
          <button type="button" class="btnSmall" onclick="buyOffer('${esc(o.id)}')">Acheter</button>
        </div>
      </div>
    `).join("");
  }

  window.buyOffer = (id) => {
    const o = OFFERS.find(x => x.id === id);
    if(!o) return;

    $("subject").value = `Achat - ${o.label} (${o.price} ‚Ç¨)`;
    $("details").value =
`Bonjour,
Je souhaite acheter l‚Äôoffre : ${o.label} (${o.price} ‚Ç¨).

Moyen de paiement : (PayPal / Crypto / Carte)
Pseudo Discord :
Infos suppl√©mentaires :`;

    scrollToTickets();
    setTimeout(() => { if(!$("pseudo").value.trim()) $("pseudo").focus(); }, 200);
  };

  // =============================
  // Tickets list UI
  // =============================
  function renderTickets(){
    const root = $("ticketsList");
    const list = loadTickets();

    if(!list.length){
      root.innerHTML = '<div class="muted">Aucun ticket enregistr√©.</div>';
      return;
    }

    root.innerHTML = list.map(t => `
      <div class="ticketBox">
        <div class="ticketTop">
          <div><b>${esc(t.subject || "Ticket")}</b></div>
          <div class="ticketId">ID: <b>${esc(t.id)}</b> ‚Ä¢ ${new Date(t.createdAt).toLocaleString()}</div>
        </div>
        <div class="ticketMsg">${esc(t.details || "")}</div>
        <div class="ticketMsg" style="color:#b9b9b9;margin-top:8px;">Contact: ${esc(t.contact || "‚Äî")}</div>
        <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
          <button type="button" class="btnGhost btnSmall" onclick="window.open('${esc(t.channelUrl || "")}','_blank')">Ouvrir sur Discord</button>
          <button type="button" class="btnGhost btnSmall" onclick="removeTicket('${esc(t.id)}')">Supprimer local</button>
        </div>
      </div>
    `).join("");
  }

  window.removeTicket = (id) => {
    saveTickets(loadTickets().filter(t => t.id !== id));
  };

  // =============================
  // API status
  // =============================
  async function checkApi(){
    const el = $("apiState");
    const set = (cls, txt) => { el.innerHTML = `<span class="statusDot ${cls}"></span>${txt}`; };

    try{
      const r = await fetch(API_URL + "/status", { cache:"no-store" });
      const j = await r.json().catch(()=> ({}));
      if(j.online === true && j.botReady === true) set("statusOk", "‚úÖ API en ligne (bot pr√™t)");
      else if(j.online === true) set("statusWarn", "‚ö†Ô∏è API en ligne (bot pas pr√™t)");
      else set("statusBad", "‚ùå API inaccessible");
    }catch{
      set("statusBad", "‚ùå API inaccessible");
    }
  }

  // =============================
  // Submit ticket (envoi API)
  // =============================
  let isSubmitting = false;

  $("ticketForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    if(isSubmitting) return;
    isSubmitting = true;

    const submitBtn = $("submitBtn");
    submitBtn.disabled = true;
    submitBtn.textContent = "Envoi...";

    const data = {
      pseudo: $("pseudo").value.trim(),
      contact: $("contact").value.trim(),
      subject: $("subject").value.trim(),
      details: $("details").value.trim(),
      idempotencyKey: (crypto?.randomUUID ? crypto.randomUUID() : ("k_" + Math.random().toString(36).slice(2) + Date.now()))
    };

    try{
      const res = await fetch(API_URL + "/api/ticket", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(data)
      });

      const json = await res.json().catch(()=> ({}));

      if(res.ok && json.ok){
        const list = loadTickets();
        list.unshift({
          id: json.id,
          subject: data.subject,
          details: data.details,
          contact: data.contact,
          createdAt: Date.now(),
          channelUrl: json.channelUrl || ""
        });
        saveTickets(list);

        alert("‚úÖ Ticket cr√©√© ! ID: " + json.id);
        if(json.channelUrl) window.open(json.channelUrl, "_blank");

        $("ticketForm").reset();
        scrollToTickets();
      } else {
        alert("‚ùå Erreur: " + (json.error || "Erreur inconnue"));
      }
    }catch{
      alert("‚ùå Erreur r√©seau");
    }finally{
      isSubmitting = false;
      submitBtn.disabled = false;
      submitBtn.textContent = "Cr√©er le ticket";
    }
  });

  // =============================
  // Buttons
  // =============================
  $("buyDiscordBtn").onclick = openDiscord;
  $("goTicketBtn").onclick = scrollToTickets;
  $("discordBtn").onclick = openDiscord;
  $("clearBtn").onclick = () => { localStorage.removeItem(STORAGE_KEY); renderTickets(); };
  $("resetBtn").onclick = () => $("ticketForm").reset();

  // Click animations / actions
  $("logoBtn").onclick = () => openDiscord(); // clique logo => discord
  $("bannerBtn").onclick = () => scrollToTickets(); // clique banni√®re => ticket

  // init
  renderShop();
  renderTickets();
  checkApi();
  setInterval(checkApi, 30000);
</script>

</body>
</html>
